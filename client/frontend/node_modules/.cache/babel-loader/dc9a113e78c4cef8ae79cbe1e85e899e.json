{"ast":null,"code":"import _toConsumableArray from\"/Users/alan/projects/rock-web-chat/client/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"/Users/alan/projects/rock-web-chat/client/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/alan/projects/rock-web-chat/client/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/alan/projects/rock-web-chat/client/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Box,Button,FormControl,Input,Modal,ModalBody,ModalCloseButton,ModalContent,ModalFooter,ModalHeader,ModalOverlay,useDisclosure,useToast}from\"@chakra-ui/react\";import React,{useState}from\"react\";import axios from\"axios\";import{ChatState}from\"../../Context/ChatProvider\";import UserListItem from\"../UserAvatar/UserListItem\";import UserBadgeItem from\"../UserAvatar/UserBadgeItem\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var GroupChatModal=function GroupChatModal(_ref){var children=_ref.children;var _useDisclosure=useDisclosure(),isOpen=_useDisclosure.isOpen,onOpen=_useDisclosure.onOpen,onClose=_useDisclosure.onClose;var _useState=useState(),_useState2=_slicedToArray(_useState,2),groupChatName=_useState2[0],setGroupChatName=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),selectedUsers=_useState4[0],setSelectedUsers=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),search=_useState6[0],setSearch=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),searchResult=_useState8[0],setSearchResult=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];var toast=useToast();var _ChatState=ChatState(),user=_ChatState.user,chats=_ChatState.chats,setChats=_ChatState.setChats;var handleSearch=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(query){var config,_yield$axios$get,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setSearch(query);if(query){_context.next=3;break;}return _context.abrupt(\"return\");case 3:_context.prev=3;setLoading(true);config={headers:{Authorization:\"Bearer \".concat(user.token)}};_context.next=8;return axios.get(\"/api/user?search=\".concat(search),config);case 8:_yield$axios$get=_context.sent;data=_yield$axios$get.data;console.log(data);setLoading(false);setSearchResult(data);_context.next=18;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](3);toast({title:\"Error Occured!\",description:\"Failed to Load the Search Results\",status:\"error\",duration:4000,isClosable:true,position:\"bottom-left\"});case 18:case\"end\":return _context.stop();}}},_callee,null,[[3,15]]);}));return function handleSearch(_x){return _ref2.apply(this,arguments);};}();var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var config,_yield$axios$post,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(!groupChatName||!selectedUsers)){_context2.next=3;break;}toast({title:\"Por favor, preencha todos os campos\",status:\"warning\",duration:4000,isClosable:true,position:\"top\"});return _context2.abrupt(\"return\");case 3:_context2.prev=3;config={headers:{Authorization:\"Bearer \".concat(user.token)}};_context2.next=7;return axios.post(\"/api/chat/group\",{name:groupChatName,users:JSON.stringify(selectedUsers.map(function(users){return users._id;}))},config);case 7:_yield$axios$post=_context2.sent;data=_yield$axios$post.data;setChats([data].concat(_toConsumableArray(chats)));onClose();toast({title:\"Novo grupo criado!\",status:\"success\",duration:4000,isClosable:true,position:\"top\"});return _context2.abrupt(\"return\");case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](3);toast({title:\"Failed to create the chat!\",description:_context2.t0.response.data,status:\"error\",duration:4000,isClosable:true,position:\"top\"});return _context2.abrupt(\"return\");case 19:case\"end\":return _context2.stop();}}},_callee2,null,[[3,15]]);}));return function handleSubmit(){return _ref3.apply(this,arguments);};}();var handleDelete=function handleDelete(delUser){setSelectedUsers(selectedUsers.filter(function(sel){return sel._id!==delUser._id;}));};var handleGroup=function handleGroup(userToAdd){if(selectedUsers.includes(userToAdd)){toast({title:\"User already added\",status:\"warning\",duration:5000,isClosable:true,position:\"top\"});return;}setSelectedUsers([].concat(_toConsumableArray(selectedUsers),[userToAdd]));};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{onClick:onOpen,children:children}),/*#__PURE__*/_jsxs(Modal,{isOpen:isOpen,onClose:onClose,children:[/*#__PURE__*/_jsx(ModalOverlay,{}),/*#__PURE__*/_jsxs(ModalContent,{children:[/*#__PURE__*/_jsx(ModalHeader,{fontSize:\"35px\",fontFamily:\"Work sans\",display:\"flex\",justifyContent:\"center\",children:\"Create Group Chat\"}),/*#__PURE__*/_jsx(ModalCloseButton,{}),/*#__PURE__*/_jsxs(ModalBody,{display:\"flex\",flexDir:\"column\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(FormControl,{placeholder:\"Chat Name\",mb:3,onChange:function onChange(e){return setGroupChatName(e.target.value);},children:/*#__PURE__*/_jsx(Input,{})}),/*#__PURE__*/_jsx(FormControl,{children:/*#__PURE__*/_jsx(Input,{placeholder:\"Add Users eg: Alan,Ozzy, Kurt\",mb:1,onChange:function onChange(e){return handleSearch(e.target.value);}})}),/*#__PURE__*/_jsx(Box,{w:\"100%\",display:\"flex\",flexWrap:\"wrap\",children:selectedUsers.map(function(u){return/*#__PURE__*/_jsx(UserBadgeItem,{user:u,handleFunction:function handleFunction(){return handleDelete(u);}},user._id);})}),loading?/*#__PURE__*/_jsx(\"div\",{children:\"loading\"}):searchResult===null||searchResult===void 0?void 0:searchResult.slice(0,4).map(function(user){return/*#__PURE__*/_jsx(UserListItem,{user:user,handleFunction:function handleFunction(){return handleGroup(user);}},user._id);})]}),/*#__PURE__*/_jsx(ModalFooter,{children:/*#__PURE__*/_jsx(Button,{colorScheme:\"blue\",onClick:handleSubmit,children:\"Create chat\"})})]})]})]});};export default GroupChatModal;","map":{"version":3,"names":["Box","Button","FormControl","Input","Modal","ModalBody","ModalCloseButton","ModalContent","ModalFooter","ModalHeader","ModalOverlay","useDisclosure","useToast","React","useState","axios","ChatState","UserListItem","UserBadgeItem","GroupChatModal","children","isOpen","onOpen","onClose","groupChatName","setGroupChatName","selectedUsers","setSelectedUsers","search","setSearch","searchResult","setSearchResult","loading","setLoading","toast","user","chats","setChats","handleSearch","query","config","headers","Authorization","token","get","data","console","log","title","description","status","duration","isClosable","position","handleSubmit","post","name","users","JSON","stringify","map","_id","response","handleDelete","delUser","filter","sel","handleGroup","userToAdd","includes","e","target","value","u","slice"],"sources":["/Users/alan/projects/rock-web-chat/client/frontend/src/components/miscellaneous/GroupChatModal.js"],"sourcesContent":["import {\n  Box,\n  Button,\n  FormControl,\n  Input,\n  Modal,\n  ModalBody,\n  ModalCloseButton,\n  ModalContent,\n  ModalFooter,\n  ModalHeader,\n  ModalOverlay,\n  useDisclosure,\n  useToast,\n} from \"@chakra-ui/react\";\nimport React, { useState } from \"react\";\nimport axios from \"axios\";\nimport { ChatState } from \"../../Context/ChatProvider\";\nimport UserListItem from \"../UserAvatar/UserListItem\";\nimport UserBadgeItem from \"../UserAvatar/UserBadgeItem\";\n\nconst GroupChatModal = ({ children }) => {\n  const { isOpen, onOpen, onClose } = useDisclosure();\n  const [groupChatName, setGroupChatName] = useState();\n  const [selectedUsers, setSelectedUsers] = useState([]);\n  const [search, setSearch] = useState(\"\");\n  const [searchResult, setSearchResult] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const toast = useToast();\n\n  const { user, chats, setChats } = ChatState();\n\n  const handleSearch = async (query) => {\n    setSearch(query);\n    if (!query) {\n      return;\n    }\n\n    try {\n      setLoading(true);\n      const config = {\n        headers: {\n          Authorization: `Bearer ${user.token}`,\n        },\n      };\n      const { data } = await axios.get(`/api/user?search=${search}`, config);\n      console.log(data);\n      setLoading(false);\n      setSearchResult(data);\n    } catch (error) {\n      toast({\n        title: \"Error Occured!\",\n        description: \"Failed to Load the Search Results\",\n        status: \"error\",\n        duration: 4000,\n        isClosable: true,\n        position: \"bottom-left\",\n      });\n    }\n  };\n\n  const handleSubmit = async () => {\n    if (!groupChatName || !selectedUsers) {\n      toast({\n        title: \"Por favor, preencha todos os campos\",\n        status: \"warning\",\n        duration: 4000,\n        isClosable: true,\n        position: \"top\",\n      });\n      return;\n    }\n    try {\n      const config = {\n        headers: {\n          Authorization: `Bearer ${user.token}`,\n        },\n      };\n      const { data } = await axios.post(\n        \"/api/chat/group\",\n        {\n          name: groupChatName,\n          users: JSON.stringify(selectedUsers.map((users) => users._id)),\n        },\n        config\n      );\n\n      setChats([data, ...chats]);\n      onClose();\n      toast({\n        title: \"Novo grupo criado!\",\n        status: \"success\",\n        duration: 4000,\n        isClosable: true,\n        position: \"top\",\n      });\n      return;\n    } catch (error) {\n      toast({\n        title: \"Failed to create the chat!\",\n        description: error.response.data,\n        status: \"error\",\n        duration: 4000,\n        isClosable: true,\n        position: \"top\",\n      });\n      return;\n    }\n  };\n\n  const handleDelete = (delUser) => {\n    setSelectedUsers(selectedUsers.filter((sel) => sel._id !== delUser._id));\n  };\n\n  const handleGroup = (userToAdd) => {\n    if (selectedUsers.includes(userToAdd)) {\n      toast({\n        title: \"User already added\",\n        status: \"warning\",\n        duration: 5000,\n        isClosable: true,\n        position: \"top\",\n      });\n      return;\n    }\n\n    setSelectedUsers([...selectedUsers, userToAdd]);\n  };\n\n  return (\n    <>\n      <span onClick={onOpen}>{children}</span>\n\n      <Modal isOpen={isOpen} onClose={onClose}>\n        <ModalOverlay />\n        <ModalContent>\n          <ModalHeader\n            fontSize=\"35px\"\n            fontFamily=\"Work sans\"\n            display=\"flex\"\n            justifyContent=\"center\"\n          >\n            Create Group Chat\n          </ModalHeader>\n          <ModalCloseButton />\n          <ModalBody display=\"flex\" flexDir=\"column\" alignItems=\"center\">\n            <FormControl\n              placeholder=\"Chat Name\"\n              mb={3}\n              onChange={(e) => setGroupChatName(e.target.value)}\n            >\n              <Input />\n            </FormControl>\n            <FormControl>\n              <Input\n                placeholder=\"Add Users eg: Alan,Ozzy, Kurt\"\n                mb={1}\n                onChange={(e) => handleSearch(e.target.value)}\n              />\n            </FormControl>\n            <Box w=\"100%\" display=\"flex\" flexWrap=\"wrap\">\n              {selectedUsers.map((u) => (\n                <UserBadgeItem\n                  key={user._id}\n                  user={u}\n                  handleFunction={() => handleDelete(u)}\n                />\n              ))}\n            </Box>\n            {loading ? (\n              <div>loading</div>\n            ) : (\n              searchResult\n                ?.slice(0, 4)\n                .map((user) => (\n                  <UserListItem\n                    key={user._id}\n                    user={user}\n                    handleFunction={() => handleGroup(user)}\n                  />\n                ))\n            )}\n          </ModalBody>\n          <ModalFooter>\n            <Button colorScheme=\"blue\" onClick={handleSubmit}>\n              Create chat\n            </Button>\n          </ModalFooter>\n        </ModalContent>\n      </Modal>\n    </>\n  );\n};\n\nexport default GroupChatModal;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}